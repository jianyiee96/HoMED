<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="template/template.xhtml">

    <ui:define name="title">Medical Board Session</ui:define>

    <ui:define name="content">
        <style type="text/css">

            .sign-true {
                background-color: #E0FAE0 !important
            }
            .sign-false {
                background-color: #FAE0E0 !important
            }
            .display-text {
                font-weight: bold;
            }
        </style>

        <ui:fragment rendered="#{medicalBoardSessionManagedBean.medicalBoardSlot.medicalBoardSlotStatusEnum != 'ALLOCATED'}">
            <h:form id="sessionForm">

                <div class="p-grid">
                    <div class="p-col-6">
                        <div class="card">
                            <h2>Medical Board Session</h2>
                            <p:panelGrid columns="2" layout="flex">
                                <h:panelGroup>
                                    <div>
                                        <i class="fa fa-clock-o icon-style"></i>
                                        <span style="font-size: 1.25rem; font-weight: bold;">Medical Board Date Information</span>
                                    </div>

                                    <h:panelGrid columns="2" cellpadding="5">
                                        <p:outputLabel value="Date: "/>
                                        <p:outputLabel class="display-text" value="#{medicalBoardSessionManagedBean.renderDate(medicalBoardSessionManagedBean.medicalBoardSlot.startDateTime)}" />

                                        <p:outputLabel value="Scheduled Start Time: " />
                                        <p:outputLabel class="display-text" value="#{medicalBoardSessionManagedBean.renderTime(medicalBoardSessionManagedBean.medicalBoardSlot.startDateTime)}" />

                                        <p:outputLabel value="Scheduled End Time: " />
                                        <p:outputLabel class="display-text" value="#{medicalBoardSessionManagedBean.renderTime(medicalBoardSessionManagedBean.medicalBoardSlot.endDateTime)}" />

                                        <p:outputLabel value="Actual Start Time: " />
                                        <p:outputLabel class="display-text" value="#{medicalBoardSessionManagedBean.renderTime(medicalBoardSessionManagedBean.medicalBoardSlot.actualStartDateTime)}" />

                                        <p:outputLabel value="Actual End Time: " />
                                        <p:outputLabel class="display-text" value="#{medicalBoardSessionManagedBean.renderTime(medicalBoardSessionManagedBean.medicalBoardSlot.actualEndDateTime)}" />

                                    </h:panelGrid>
                                </h:panelGroup>
                                <h:panelGroup>
                                    <i class="fa fa-user-md icon-style"></i>
                                    <span style="font-size: 1.25rem; font-weight: bold;">Medical Board Members</span>
                                    <h:panelGrid columns="2" cellpadding="5">

                                        <h:outputText value="Chairman: " />
                                        <h:outputText class="display-text" value="#{medicalBoardSessionManagedBean.medicalBoardSlot.chairman.name}" />

                                        <h:outputText value="Medical Officer 1: " />
                                        <h:outputText class="display-text" value="#{medicalBoardSessionManagedBean.medicalBoardSlot.medicalOfficerOne.name}" />

                                        <h:outputText value="Medical Officer 2: "/>
                                        <h:outputText class="display-text" value="#{medicalBoardSessionManagedBean.medicalBoardSlot.medicalOfficerTwo.name}" />
                                    </h:panelGrid>
                                </h:panelGroup>
                            </p:panelGrid>
                            <p:separator />
                            
                            
                            <p:separator />

                            <p:dataTable widgetVar="sessionDT" id="queueDT" var="case" value="#{medicalBoardSessionManagedBean.medicalBoardSlot.medicalBoardCases}"
                                         rowKey="#{case.medicalBoardCaseId}" selectionMode="single" selection="#{medicalBoardSessionManagedBean.selectedCase}"
                                         styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" rowStyleClass="#{medicalBoardSessionManagedBean.backgroundStyle(case)}"
                                         sortBy="#{case.medicalBoardCaseStatus}">
                                <p:ajax event="rowSelect" update="sessionForm" process="@this"/>
                                <f:facet id="dataViewListHeader" name="header">
                                    <div style="display: flex; align-items: center; justify-content: space-between; height:16px">
                                        <h:outputText value="Medical Board Cases"></h:outputText>
                                        <p:commandButton update="sessionForm" value="Next Case" icon="fa fa-share-square-o" >
                                            <f:setPropertyActionListener target="#{medicalBoardSessionManagedBean.selectedCase}" value="#{medicalBoardSessionManagedBean.selectedCase}"/>
                                        </p:commandButton>
                                    </div>
                                </f:facet>
                                <p:column headerText="Case ID" width="10%">
                                    <h:outputText value="#{case.medicalBoardCaseId}" />
                                </p:column>
                                <p:column headerText="Serviceman Name">
                                    <h:outputText value="#{case.consultation.booking.serviceman.name}" />
                                </p:column>
                                <p:column headerText="Board Type">
                                    <h:outputText value="#{case.medicalBoardType}" styleClass="form-status-badge"/>
                                </p:column>

                                <p:column headerText="PMB Review Date">
                                    <h:outputText value="#{case.consultation.endDateTime}">
                                        <f:convertDateTime pattern="dd-MM-yyyy HH:mm"/>
                                    </h:outputText>
                                </p:column>

                            </p:dataTable>

                        </div>
                    </div>
                    <div class="p-col-6">                        
                        <div class="timeline card card-w-title">
                            <h2>Medical Board Case [#{medicalBoardSessionManagedBean.selectedCase.medicalBoardCaseId}]</h2>
                            <ul>
                                <li>
                                    <p:panelGrid columns="2" layout="flex">
                                        <h:panelGroup>
                                            <h5>Serviceman Information</h5>
                                            <h:panelGrid columns="2" cellpadding="5">
                                                <p:outputLabel value="Name: " />
                                                <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.consultation.booking.serviceman.name}" class="display-text"/>                                

                                                <p:outputLabel value="Email " />
                                                <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.consultation.booking.serviceman.email}" class="display-text"/>

                                                <p:outputLabel value="Gender: " />
                                                <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.consultation.booking.serviceman.gender}" class="display-text"/>

                                                <p:outputLabel value="Blood type: " />
                                                <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.consultation.booking.serviceman.bloodType.bloodTypeString}" class="display-text"/>

                                                <p:outputLabel value="Role: " />
                                                <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.consultation.booking.serviceman.role.stringVal}" class="display-text"/>

                                                <p:outputLabel value="ROD date: " />
                                                <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.consultation.booking.serviceman.rod}" class="display-text">
                                                    <f:convertDateTime pattern="dd/MM/yyyy" />
                                                </p:outputLabel>
                                            </h:panelGrid>
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <h5>Reviewing Doctor Information</h5>
                                            <h:panelGrid columns="2" cellpadding="5">
                                                <p:outputLabel value="Name: " />
                                                <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.consultation.medicalOfficer.name}" class="display-text" />                                

                                                <p:outputLabel value="Email: " />
                                                <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.consultation.medicalOfficer.email}" class="display-text" />                                

                                                <p:outputLabel value="Phone Number: " />
                                                <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.consultation.medicalOfficer.phoneNumber}" class="display-text" />
                                            </h:panelGrid>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </li>

                                <li>                                    
                                    <p:panelGrid columns="1" style="margin-right: 20px;" layout="flex">
                                        <h5>Statement of Case</h5>
                                        <h:panelGrid style="margin-top: -30px" frame="box" columns="1" width="100%">
                                            <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.statementOfCase}" escape="false" />
                                        </h:panelGrid>
                                    </p:panelGrid>
                                </li>

                                <li>
                                    <p:panelGrid columns="1" style="margin-right: 20px;" layout="flex">                                        
                                        <h5>Findings of the Board</h5>

                                        <h:panelGrid rendered="#{medicalBoardSessionManagedBean.selectedCase.isSigned}" frame="box" columns="1" style="margin-top: -30px" width="100%">
                                            <p:outputLabel value="#{medicalBoardSessionManagedBean.selectedCase.boardFindings}" escape="false" />
                                        </h:panelGrid>
                                        <p:textEditor rendered="#{not medicalBoardSessionManagedBean.selectedCase.isSigned}"
                                                      widgetVar="text-editor" value="#{medicalBoardSessionManagedBean.selectedCase.boardFindings}" 
                                                      height="200" style="margin-bottom:5px; ">
                                            <f:facet name="toolbar">
                                                <span class="ql-formats">
                                                    <button class="ql-bold"></button>
                                                    <button class="ql-italic"></button>
                                                    <button class="ql-underline"></button>
                                                    <button class="ql-strike"></button>
                                                </span>
                                                <span class="ql-formats">
                                                    <button class="ql-header" value="1"></button>
                                                    <button class="ql-header" value="2"></button>
                                                </span>
                                                <span class="ql-formats">
                                                    <button class="ql-list" value="ordered"></button>
                                                    <button class="ql-list" value="bullet"></button>
                                                    <button class="ql-indent" value="-1"></button>
                                                    <button class="ql-indent" value="+1"></button>
                                                </span>
                                                <span class="ql-formats">
                                                    <select class="ql-color"></select>
                                                    <select class="ql-background"></select>
                                                </span>
                                                <span class="ql-formats">
                                                    <button class="ql-clean"></button>
                                                </span>
                                            </f:facet>
                                            <p:ajax event="keyup" process="@this"/>
                                        </p:textEditor>
                                    </p:panelGrid>



                                </li>
                                <li>

                                    <ui:fragment rendered="#{not medicalBoardSessionManagedBean.selectedCase.isSigned}">


                                        <div style="display: flex; justify-content: center">
                                            <p:commandButton update="sessionForm" actionListener="#{medicalBoardSessionManagedBean.signSelectedCase()}" value="Sign Case" class="success-button p-ml-2" icon="pi pi-check-square">
                                                <p:confirm header="Sign Confirmation" message="Confirm Sign Case? Board Findings and Medical Board Results will be recorded in the system." icon="pi pi-exclamation-triangle" />
                                            </p:commandButton>
                                        </div>

                                    </ui:fragment>

                                    <ui:fragment rendered="#{medicalBoardSessionManagedBean.selectedCase.isSigned}">
                                        <h5>This Case Is Signed and is on view only mode.</h5>
                                    </ui:fragment>

                                </li>


                            </ul>



                        </div>
                    </div>
                </div>

                <p:confirmDialog global="true" width="500" >
                    <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
                </p:confirmDialog>
                <p:growl id="growl-message" for="growl-message" showDetail="true">
                    <p:autoUpdate/>
                </p:growl>

            </h:form>
        </ui:fragment>

    </ui:define>

</ui:composition>