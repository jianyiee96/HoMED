<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="template/template.xhtml"
                xmlns:ezcomp="http://xmlns.jcp.org/jsf/composite/ezcomp">

    <ui:define name="title">Report Management</ui:define>


    <ui:define name="content">
        <h:outputStylesheet name="crud-tables.css" library="css" />
        <style type="text/css">
            .ui-sticky {
                top: 86px !important;
            }
            @media (max-width: 960px) {
                .ui-sticky {
                    top: 86px !important;
                }
            }
            .report-cols {
                text-align: center;
            }
            .report-name, .report-name.ui-inputfield {
                text-align: center;
                font-weight: bold;
                font-size: 30px;
            }
            .report-subtitle, .report-subtitle.ui-inputfield {
                font-size: 20px;
                font-style: italic;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            .field-name, .field-name.ui-inputfield {
                font-weight: bold;
                font-size: 23px;
            }
            .field-subtitle, .field-subtitle.ui-inputfield {
                font-size: 15px;
                font-style: italic;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            .line-icon::before,
            .line-icon::after {      
                /* Styles kept */
                width: 35%;
                height: 1px;

                /* Changed to border-top (instead of border) to simulate a line better */
                border-top: 1px solid #ccc; 

                /* Styles added */
                display: inline-block;
                content: '';

                /* Use padding to vertical align the line */
                /* Use padding in em for a responsive icon height */
                padding-top: 0.5em; 

                /* Use margins to give the lines some spacement around the icon */
                /* Use margins in % for a responsive spacement */
                margin-left: 5%; 
                margin-right: 5%;
            }
            .card.field-card {
                -webkit-box-shadow: 0px 0px 11px 1px rgba(150,150,150,1);
                -moz-box-shadow: 0px 0px 11px 1px rgba(150,150,150,1);
                box-shadow: 0px 0px 6px 1px rgba(150,150,150,1);
                border-radius: 15px; 
            }
            .dlg-add-chart .ui-dialog-content.ui-widget-content {
                padding-top: 0;
            }
            .total-quantity-font {
                font-family: Georgia, serif;
                font-size: 20px;
                letter-spacing: 2px;
                word-spacing: 2px;
                color: #8C8C8C;
                font-weight: normal;
                text-decoration: none;
                font-style: normal;
                font-variant: normal;
                text-transform: none;
            }

            .p-col-12.col-no-padding {
                padding: 0;
            }
        </style>
        <script type="text/javascript">
            //<![CDATA[
            PrimeFaces.widget.DatePicker.prototype.fireDateSelectEvent = function () {
                // #5830: do not fire in range mode if only the first value is set
                if (this.cfg.selectionMode === "range" && this.input.val().indexOf(this.cfg.rangeSeparator) === -1) {
                    return;
                }

                this.callBehavior('dateSelect');
            };
            //]]>
        </script>
        <f:metadata>
            <f:viewParam name="reportToViewId"/>
        </f:metadata>

        <ezcomp:pageRedirect rendered="#{manageReportManagedBean.report eq null}" btnValue="Report Management Page"
                             header="#{manageReportManagedBean.redirectMessage}" btnOutcome="/report-management.xhtml" btnIcon="fa fa-files-o"/>

        <h:form id="formReport" rendered="#{manageReportManagedBean.report ne null}">
            <f:event type="preRenderComponent" listener="#{manageReportManagedBean.checkCreation()}"/>
            <p:focus context="panelReport" />
            <p:confirmDialog global="true" width="500px">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
            </p:confirmDialog>
            <p:growl id="growl-message" for="growl-message" showDetail="true" />
            <p:toolbar id="tb" style="margin-top: -16px">
                <f:facet name="left">
                    <div class="p-mt-2">
                        <h:outputText value="Last Modified: " style="font-weight: 800"/>
                        <h:outputText value="#{manageReportManagedBean.report.lastModified}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                        </h:outputText>
                        <h:outputText value="Published Date: " style="font-weight: 800" class="p-ml-4"/>
                        <h:outputText value="Not Published" rendered="#{empty manageReportManagedBean.report.datePublished}"/>
                        <h:outputText value="#{manageReportManagedBean.report.datePublished}" rendered="#{not empty manageReportManagedBean.report.datePublished}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                        </h:outputText>
                    </div>
                </f:facet>
                <f:facet name="right">
                    <p:commandButton class="p-mr-2 warning-button" title="Clone" icon="fa fa-files-o"
                                     actionListener="#{manageReportManagedBean.doClone()}"
                                     rendered="#{not manageReportManagedBean.isEditMode}"
                                     process="@this" update="@form"/>
                    <h:panelGroup rendered="#{not manageReportManagedBean.isViewState}">
                        <p:commandButton rendered="#{manageReportManagedBean.isCreateState}" class="p-mr-2 info-button" title="Create" icon="fa fa-pencil-square-o" process="@form"
                                         value="Create" actionListener="#{manageReportManagedBean.doCreate}" update="@form"/>
                        <h:panelGroup rendered="#{not manageReportManagedBean.isCreateState}">
                            <h:panelGroup rendered="#{not manageReportManagedBean.isEditMode}" >
                                <p:commandButton class="p-mr-2 success-button" title="Publish" icon="pi pi-upload"
                                                 actionListener="#{manageReportManagedBean.doPublish()}"
                                                 rendered="#{empty manageReportManagedBean.report.datePublished}"
                                                 process="@this" update="@form">
                                    <p:confirm header="Publish Report" message="Confirm publish report?" icon="pi pi-exclamation-triangle" />
                                </p:commandButton>
                                <p:commandButton class="p-mr-2 success-button" title="Unpublish" icon="pi pi-undo"
                                                 actionListener="#{manageReportManagedBean.doUnpublish()}"
                                                 rendered="#{not empty manageReportManagedBean.report.datePublished}"
                                                 process="@this" update="@form"/>
                                <p:commandButton class="p-mr-2 danger-button" title="Delete" icon="pi pi-trash"
                                                 actionListener="#{manageReportManagedBean.doDelete()}"
                                                 process="@this" update="@form">
                                    <p:confirm header="Delete Report" message="Confirm delete report?" icon="pi pi-exclamation-triangle" />
                                </p:commandButton>
                                <p:commandButton class="p-mr-2 info-button" title="Edit" icon="pi pi-pencil" 
                                                 value="Edit" actionListener="#{manageReportManagedBean.doEdit}"
                                                 process="@this" update="@form"/>
                            </h:panelGroup>
                            <p:commandButton rendered="#{manageReportManagedBean.isEditMode}" class="p-mr-2 info-button" title="Done Editing" icon="pi pi-check"
                                             value="Done Editing" actionListener="#{manageReportManagedBean.doEdit}" 
                                             process="@form" update="@form" />
                        </h:panelGroup>
                    </h:panelGroup>
                </f:facet>
            </p:toolbar>
            <p:sticky target="tb" />
            <p:panel id="panelReport">
                <div class="p-grid p-justify-center"  style="padding: 3rem">
                    <div class="p-col-12 p-md-8" style="padding-top: 50px;padding-bottom: 50px;">
                        <div class="p-grid p-dir-col report-cols p-justify-center">
                            <h:outputText class="report-name" value="#{not empty manageReportManagedBean.report.name ? manageReportManagedBean.report.name : 'Enter Report Name'}"
                                          rendered="#{not manageReportManagedBean.isEditMode}"/>
                            <p:inputText id="report-name" class="report-name" value="#{manageReportManagedBean.report.name}" placeholder="Enter Report Name"
                                         rendered="#{manageReportManagedBean.isEditMode}">
                                <p:ajax process="@this" update="@this message-report-name"/>
                            </p:inputText>
                            <p:message for="report-name" class="error-message" id="message-report-name"/>
                            <p:separator/>
                            <h:outputText class="report-subtitle" value="#{manageReportManagedBean.report.description}"
                                          rendered="#{not manageReportManagedBean.isEditMode and not empty manageReportManagedBean.report.description}"/>
                            <p:inputTextarea class="report-subtitle" value="#{manageReportManagedBean.report.description}" placeholder="Enter Report Description"
                                             rendered="#{manageReportManagedBean.isEditMode}">
                                <p:ajax process="@this" update="@this"/>
                            </p:inputTextarea>
                            <div class="p-col-12">
                                <h:panelGroup id="panelGroupDateFilterBtn">
                                    <p:commandButton class="p-mt-5" icon="pi pi-clock" style="opacity: 1; font-size: 18px"
                                                     oncomplete="PF('dialogFilterDate').show()"
                                                     actionListener="#{manageReportManagedBean.doOpenDialogFilterDate}"
                                                     process="@this" update="formReport:dialogFilterDate"
                                                     rendered="#{manageReportManagedBean.isEditMode or manageReportManagedBean.report.filterDateType != 'NONE'}"
                                                     disabled="#{not manageReportManagedBean.isEditMode}"
                                                     value="#{manageReportManagedBean.report.filterDateType == 'NONE' ? 'Set Global Date Filter' : manageReportManagedBean.report.filterDateString}">
                                        <p:confirm disabled="#{not manageReportManagedBean.checkAnyFieldRequiresDate()}" header="Global Date Filter" escape="false"
                                                   message="There are fields in this report that relies on a date filter, changing the current date filter will impact the fields.&lt;br/&gt;&lt;br/&gt;Proceed?"
                                                   icon="pi pi-exclamation-triangle" />
                                    </p:commandButton>
                                </h:panelGroup>
                            </div>
                        </div>
                    </div>
                    <ui:fragment id ="fragmentReportFields">
                        <ui:fragment rendered="#{empty manageReportManagedBean.reportFieldWrappers}">
                            <div class="p-col-12 p-md-8 p-mb-5">
                                <div style="display: flex; justify-content: center">
                                    <h:outputText value="No Report Fields" class="total-quantity-font"/>
                                </div>
                            </div>
                        </ui:fragment>
                        <ui:repeat id="ui-wrappers" value="#{manageReportManagedBean.reportFieldWrappers}" var="wrapper" varStatus="status">
                            <div class="card field-card p-col-12 p-md-8 p-mb-5">
                                <h:panelGroup rendered="#{wrapper.reportField.type == 'HEADER' and manageReportManagedBean.isEditMode}">
                                    <div class="p-grid p-m-3">
                                        <div class="p-col-11 p-col-nogutter">
                                            <p:inputText id="field-name" class="field-name p-col-12" value="#{wrapper.reportField.name}" placeholder="Enter Field Name">
                                                <p:ajax process="@this" update="@this message-field-name"/>
                                            </p:inputText>
                                            <p:message for="field-name" class="error-message" id="message-field-name"/>
                                        </div>
                                        <div class="p-col-1 p-col-nogutter">
                                            <p:commandButton id="menu-header" icon="pi pi-bars" class="text-button rounded-button p-ml-2" style="float:right;"
                                                             rendered="#{manageReportManagedBean.isEditMode}">
                                            </p:commandButton>
                                            <p:menu overlay="true" trigger="menu-header" my="left top" at="left bottom">
                                                <p:submenu label="Options">
                                                    <p:menuitem value="Delete Field" icon="pi pi-trash" actionListener="#{manageReportManagedBean.doDeleteFieldWrapper(wrapper)}"
                                                                process="@this" update="formReport:panelReport" resetValues="true">
                                                        <p:confirm header="Delete Report Field" message="Confirm delete #{wrapper.reportField.type.text} field?" icon="pi pi-exclamation-triangle" />
                                                    </p:menuitem>
                                                    <p:menuitem value="Shift Up" icon="pi pi-chevron-up" actionListener="#{manageReportManagedBean.doShiftUp(status.index)}"
                                                                process="@this" update="formReport:panelReport" immediate="true" resetValues="true"
                                                                rendered="#{status.index != 0}">
                                                    </p:menuitem>
                                                    <p:menuitem value="Shift Down" icon="pi pi-chevron-down" actionListener="#{manageReportManagedBean.doShiftDown(status.index)}"
                                                                process="@this" update="formReport:panelReport" immediate="true" resetValues="true"
                                                                rendered="#{status.index != manageReportManagedBean.reportFieldWrappers.size() - 1}">
                                                    </p:menuitem>
                                                </p:submenu>
                                            </p:menu>
                                        </div>
                                        <div class="p-col-12 p-md-11 p-col-nogutter">  
                                            <p:separator class="p-my-1"/>
                                        </div>
                                        <div class="p-col-12 p-col-nogutter p-mt-2">
                                            <p:inputTextarea class="field-subtitle p-col-12 p-md-11" value="#{wrapper.reportField.description}" placeholder="Enter Field Description">
                                                <p:ajax process="@this" update="@this"/>
                                            </p:inputTextarea>
                                        </div>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{(wrapper.reportField.type == 'HEADER' and not manageReportManagedBean.isEditMode) or wrapper.reportField.type != 'HEADER'}">
                                    <div class="p-grid p-m-3">
                                        <div class="p-col-12 p-col-nogutter">
                                            <div style="display: flex; justify-content: space-between">
                                                <h:outputText class="field-name p-col-12 p-md-9" value="#{wrapper.reportField.name}"/>
                                                <div class="p-col-12 p-md-3 p-col-nogutter" style="display: flex; align-items: center; justify-content: flex-end">
                                                    <h:panelGroup rendered="#{wrapper.reportField.filterDateType ne null and wrapper.reportField.filterDateType != 'NONE'}">
                                                        <i class="pi pi-clock field-subtitle p-mr-2"/>
                                                        <h:outputText class="field-subtitle" value="#{wrapper.reportField.filterDateString}"/>
                                                    </h:panelGroup>
                                                    <p:commandButton id="menu-non-header" icon="pi pi-bars" class="text-button rounded-button p-ml-2" style="float:right;"
                                                                     rendered="#{manageReportManagedBean.isEditMode}">
                                                    </p:commandButton>
                                                    <p:menu overlay="true" trigger="menu-non-header" my="left top" at="left bottom">
                                                        <p:submenu label="Options">
                                                            <p:menuitem value="Edit Chart" icon="pi pi-pencil" actionListener="#{manageReportManagedBean.doOpenDialogEditChart(wrapper, status.index)}"
                                                                        process="@this" update="@form:dialogAddChart" resetValues="true"
                                                                        oncomplete="PF('dialogAddChart').show()">
                                                            </p:menuitem>
                                                            <p:menuitem value="Delete Field" icon="pi pi-trash" actionListener="#{manageReportManagedBean.doDeleteFieldWrapper(wrapper)}"
                                                                        process="@this" update="formReport:panelReport" resetValues="true">
                                                                <p:confirm header="Delete Report Field" message="Confirm delete #{wrapper.reportField.type.text} field?" icon="pi pi-exclamation-triangle" />
                                                            </p:menuitem>
                                                            <p:menuitem value="Shift Up" icon="pi pi-chevron-up" actionListener="#{manageReportManagedBean.doShiftUp(status.index)}"
                                                                        process="@this" update="formReport:panelReport" immediate="true" resetValues="true"
                                                                        rendered="#{status.index != 0}">
                                                            </p:menuitem>
                                                            <p:menuitem value="Shift Down" icon="pi pi-chevron-down" actionListener="#{manageReportManagedBean.doShiftDown(status.index)}"
                                                                        process="@this" update="formReport:panelReport" immediate="true" resetValues="true"
                                                                        rendered="#{status.index != manageReportManagedBean.reportFieldWrappers.size() - 1}">
                                                            </p:menuitem>
                                                        </p:submenu>
                                                    </p:menu>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="p-col-12 p-md-12 p-col-nogutter">  
                                            <p:separator class="p-my-1"/>
                                        </div>
                                        <div class="p-col-12 p-col-nogutter p-mt-2">
                                            <h:outputText class="field-subtitle p-col-12 p-md-12" value="#{wrapper.reportField.description}"
                                                          rendered="#{not empty wrapper.reportField.description}"/>
                                        </div>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{wrapper.reportField.type != 'HEADER'}">
                                    <div class="p-grid p-m-3">
                                        <div class="p-col-12">
                                            <p:pieChart model="#{wrapper.chart}" rendered="#{wrapper.reportField.type == 'PIE'}"/>
                                            <ui:fragment rendered="#{wrapper.reportField.type == 'BAR'}">
                                                <div class="p-grid p-mt-3 p-align-center">
                                                    <div class="p-col-12 p-col-nogutter">
                                                        <div class="p-grid p-align-center">
                                                            <div class="p-col-1 p-col-nogutter" style="text-align: right">
                                                                <h:outputText value="#{wrapper.reportField.reportDataGrouping.y_axis}" style="padding: 0; writing-mode:vertical-lr;transform: rotate(180deg);"/>
                                                            </div>
                                                            <div class="p-col-11 p-col-nogutter">
                                                                <p:barChart model="#{wrapper.chart}" style="width: 100%; height: 400px;"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="p-offset-1 p-col-11 p-col-nogutter" style="text-align: center">
                                                        <h:outputText value="#{wrapper.reportField.reportDataGrouping.x_axis}" class="p-col" style="text-align: center"/>
                                                    </div>

                                                </div>
                                            </ui:fragment>
                                        </div>
                                        <div class="p-col-12 p-mt-2 p-col-nogutter">
                                            <h:outputText class="total-quantity-font" value="Total Quantity: #{manageReportManagedBean.getTotalNumberOfData(wrapper.reportField)}"/>
                                        </div>
                                    </div>
                                </h:panelGroup>
                            </div>

                        </ui:repeat>
                    </ui:fragment>
                    <ui:fragment rendered="#{manageReportManagedBean.isEditMode}">
                        <div class="p-col-12 p-md-8 report-cols">
                            <div class='line-container'>
                                <div class='line-icon'>
                                    <p:commandLink id="cmdlink-add" process="@this" style="position: relative;">
                                        <i class="pi pi-plus" style="font-weight: bold; font-size: 25px"/>
                                    </p:commandLink>
                                    <p:menu overlay="true" trigger="cmdlink-add" my="left top" at="left bottom">
                                        <p:submenu label="New Field">
                                            <p:menuitem value="Header" icon="fa fa-header" actionListener="#{manageReportManagedBean.addHeader}" process="@this" update="panelReport"/>
                                            <p:menuitem value="Chart" icon="pi pi-chart-line" actionListener="#{manageReportManagedBean.doOpenDialogAddChart}" update="@form:dialogAddChart" process="@this" resetValues="true"
                                                        oncomplete="PF('dialogAddChart').show()">
                                            </p:menuitem>
                                        </p:submenu>
                                    </p:menu>
                                </div>
                            </div>
                        </div>
                    </ui:fragment>
                </div>
            </p:panel>
            <p:dialog id="dialogFilterDate" widgetVar="dialogFilterDate" header="Select Global Date Filter" showEffect="fade"
                      draggable="false" modal="true" responsive="true" fitViewport="true" onShow="PF('dialogFilterDate').initPosition()"
                      minWidth="500" width="700">
                <p:outputPanel id="panelFilterDate">
                    <div class="p-grid">
                        <div class="p-col-3">
                            <p:selectOneRadio value="#{manageReportManagedBean.filterDateType}" layout="responsive" columns="1">
                                <f:selectItems value="#{manageReportManagedBean.filterDateTypes}" var="type" itemLabel="#{type.text}" itemValue="#{type}"/>
                                <p:ajax event="change" process="@this" update="panelFilterDate" oncomplete="PF('dialogFilterDate').initPosition()" resetValues="true" listener="#{manageReportManagedBean.selectFilterDateType}"/>
                            </p:selectOneRadio>
                        </div>
                        <div class="p-col-9">
                            <div class="ui-fluid p-formgrid p-grid">
                                <div class="p-field p-col">
                                    <ui:fragment rendered="#{manageReportManagedBean.filterDateType == 'DAY' or manageReportManagedBean.filterDateType == 'WEEK' or manageReportManagedBean.filterDateType == 'CUSTOM'}">
                                        <p:outputLabel for="date-start" value="#{(manageReportManagedBean.filterDateType == 'WEEK' or manageReportManagedBean.filterDateType == 'CUSTOM')? 'Start ' : 'Select '}Date" />
                                        <p:inputText id="date-start" value="#{manageReportManagedBean.filterStartDate}" placeholder="dd/mm/yyyy"
                                                     required="true" requiredMessage="Start Date Must be Provided">  
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                            <p:ajax event="valueChange" process="@this" update="panelFilterDate" listener="#{manageReportManagedBean.typeFilterDate}"/>
                                        </p:inputText>
                                        <p:message for="date-start" class="error-message"/>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{manageReportManagedBean.filterDateType == 'MONTH'}">
                                        <p:outputLabel for="date-month" value="Select Month" />
                                        <p:inputText id="date-month" value="#{manageReportManagedBean.filterStartDate}" placeholder="mmm yyyy"
                                                     required="true" requiredMessage="Month and Year Must be Provided">  
                                            <f:convertDateTime pattern="MMM yyyy"/>
                                            <p:ajax event="valueChange" process="@this" update="panelFilterDate"/>
                                        </p:inputText>
                                        <p:message for="date-month" class="error-message"/>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{manageReportManagedBean.filterDateType == 'YEAR'}">
                                        <p:outputLabel for="date-year" value="Select Year" />
                                        <p:selectOneMenu id="date-year" value="#{manageReportManagedBean.filterStartDate}">  
                                            <f:convertDateTime pattern="yyyy"/>
                                            <f:selectItems value="#{manageReportManagedBean.years}" var="year"/>
                                            <p:ajax event="valueChange" process="@this" update="panelFilterDate"/>
                                        </p:selectOneMenu>
                                        <p:message for="date-year" class="error-message"/>
                                    </ui:fragment>
                                </div>
                                <div class="p-field p-col">
                                    <ui:fragment rendered="#{(manageReportManagedBean.filterDateType == 'WEEK' or manageReportManagedBean.filterDateType == 'CUSTOM')}">
                                        <p:outputLabel for="date-end" value="End Date" />
                                        <p:inputText id="date-end" value="#{manageReportManagedBean.filterEndDate}" placeholder="dd/mm/yyyy"
                                                     required="true" requiredMessage="End Date Must be Provided">  
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                            <p:ajax event="valueChange" process="@this" update="panelFilterDate" listener="#{manageReportManagedBean.typeFilterDate}"/>
                                        </p:inputText>
                                        <p:message for="date-end" class="error-message"/>
                                    </ui:fragment>
                                </div>
                            </div>
                            <div class="ui-fluid p-field">
                                <p:datePicker value="#{manageReportManagedBean.filterStartDate}" inline="true" pattern="dd/MM/yyyy" maxdate="#{manageReportManagedBean.today}"
                                              locale="en_GB"
                                              rendered="#{manageReportManagedBean.filterDateType == 'DAY'}">
                                    <p:ajax event="dateSelect" process="@this" update="panelFilterDate" resetValues="true"/>
                                </p:datePicker>
                                <p:datePicker view="month" value="#{manageReportManagedBean.filterStartDate}"  inline="true" pattern="MMM yyyy" maxdate="#{manageReportManagedBean.today}"
                                              yearNavigator="true" yearRange="#{manageReportManagedBean.yearRange}" 
                                              locale="en_GB"
                                              rendered="#{manageReportManagedBean.filterDateType == 'MONTH'}">
                                    <p:ajax event="dateSelect" process="@this" update="panelFilterDate" />
                                </p:datePicker>
                                <p:datePicker value="#{manageReportManagedBean.filterRangeDates}" inline="true" pattern="dd/MM/yyyy" maxdate="#{manageReportManagedBean.today}"
                                              locale="en_GB" selectionMode="range"
                                              rendered="#{manageReportManagedBean.filterDateType == 'WEEK' or manageReportManagedBean.filterDateType == 'CUSTOM'}">
                                    <p:ajax event="dateSelect" process="@this" update="panelFilterDate" listener="#{manageReportManagedBean.selectFilterRangeDate}" resetValues="true"/>
                                </p:datePicker>
                            </div>
                        </div>
                        <div class="p-col-12" style="text-align: center">
                            <p:messages for="panelFilterDate"/>
                            <p:commandButton value="Confirm Selection" styleClass="ui-confirmdialog-yes" icon="pi pi-check"
                                             actionListener="#{manageReportManagedBean.doFilterDate}"
                                             process="panelFilterDate" update="@form"/>
                        </div>
                    </div>
                </p:outputPanel>        
            </p:dialog>
            <p:dialog id="dialogAddChart" widgetVar="dialogAddChart" header="#{manageReportManagedBean.dialogHeaderAddChart}" showEffect="fade"
                      draggable="false" modal="true" responsive="true" fitViewport="true" onShow="PF('dialogAddChart').initPosition()"
                      minWidth="500" width="700" class="dlg-add-chart">
                <p:outputPanel id="panelAddChart" rendered="#{not empty manageReportManagedBean.reportFieldToAddWrapper}">
                    <div class="p-grid">
                        <div class="p-col-12 p-mb-5">
                            <div class="p-grid p-justify-center">
                                <p:steps activeIndex="#{manageReportManagedBean.idxAddChart}" style="width: 100%">
                                    <p:menuitem value="Data"/>
                                    <p:menuitem value="Date"/>
                                    <p:menuitem value="Chart"/>
                                    <p:menuitem value="Preview"/>
                                </p:steps>
                            </div>
                        </div>
                        <div class="p-col-12">
                            <div class="p-grid p-justify-between p-align-center">
                                <p:commandButton update="panelAddChart" process="@this"
                                                 disabled="#{manageReportManagedBean.idxAddChart == 0}"
                                                 icon="pi pi-angle-left" styleClass="rounded-button outlined-button p-mr-2" style="width: 2.5rem; height: 2.5rem"
                                                 oncomplete="PF('dialogAddChart').initPosition()">
                                    <f:setPropertyActionListener target="#{manageReportManagedBean.idxAddChart}" value="#{manageReportManagedBean.idxAddChart - 1}"/>
                                </p:commandButton>
                                <div class="p-col">
                                    <h:panelGroup rendered="#{manageReportManagedBean.idxAddChart == 0}" id="panelGroupData">
                                        <div class="p-formgrid p-grid ui-fluid">
                                            <div class="p-field p-col-12">
                                                <p:outputLabel for="data-type" value="Select Data Type" />
                                                <p:selectOneMenu id="data-type" value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.reportDataType}">  
                                                    <f:selectItems value="#{manageReportManagedBean.reportDataTypes}" var="type" itemLabel="#{type.text}"/>
                                                    <p:ajax process="@this" update="panelGroupData"/>
                                                </p:selectOneMenu>
                                                <p:message for="data-type" class="error-message"/>
                                            </div>
                                            <div class="p-field p-col-12">
                                                <p:outputLabel for="data-values" value="Select Data Value" />
                                                <p:selectOneMenu id="data-values" value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.reportDataValue}">  
                                                    <f:selectItems value="#{manageReportManagedBean.reportDataValues}" var="value" itemLabel="#{value.text}"/>
                                                    <p:ajax process="@this" update="panelGroupData"/>
                                                </p:selectOneMenu>
                                                <p:message for="data-values" class="error-message"/>
                                            </div>
                                            <h:panelGroup rendered="#{not empty manageReportManagedBean.reportDataGroupings}">
                                                <div class="p-field p-col-12">
                                                    <p:outputLabel for="data-group" value="Select Data Grouping" />
                                                    <p:selectOneMenu id="data-group" value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.reportDataGrouping}">
                                                        <f:selectItems value="#{manageReportManagedBean.reportDataGroupings}" var="grouping" itemLabel="#{grouping.text}"/>
                                                        <p:ajax process="@this" update="panelGroupData"/>
                                                    </p:selectOneMenu>
                                                    <p:message for="data-group" class="error-message"/>
                                                </div>
                                            </h:panelGroup>
                                        </div>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{manageReportManagedBean.idxAddChart == 1}" id="panelGroupDate">
                                        <div class="p-formgrid p-grid ui-fluid">
                                            <h:panelGroup rendered="#{manageReportManagedBean.checkAddChartDate()}">
                                                <div class="p-field p-col-12">
                                                    <ui:fragment rendered="#{manageReportManagedBean.report.filterDateType != 'NONE'}">
                                                        <h5>Global Date Filter Already Applied</h5>
                                                        <i class="pi pi-clock p-mr-2" style="font-size: 20px"/><h:outputText value="#{manageReportManagedBean.report.filterDateString}" style="font-size: 20px"/>
                                                    </ui:fragment>
                                                    <ui:fragment rendered="#{manageReportManagedBean.report.filterDateType == 'NONE'}">
                                                        <h5 class="p-mb-5">Date Selection for Dataset</h5>
                                                        <p:outputPanel id="panelGroupDateSelect">
                                                            <div class="p-grid">
                                                                <div class="p-col-3">
                                                                    <p:selectOneRadio value="#{manageReportManagedBean.filterDateType}" layout="responsive" columns="1">
                                                                        <f:selectItems value="#{manageReportManagedBean.filterDateTypes}" var="type" itemLabel="#{type.text}" itemValue="#{type}"/>
                                                                        <p:ajax event="change" process="@this" update="panelGroupDateSelect" oncomplete="PF('dialogAddChart').initPosition()" resetValues="true" listener="#{manageReportManagedBean.selectFilterDateType}"/>
                                                                    </p:selectOneRadio>
                                                                </div>
                                                                <div class="p-col-9">
                                                                    <div class="ui-fluid p-formgrid p-grid">
                                                                        <div class="p-field p-col">
                                                                            <ui:fragment rendered="#{manageReportManagedBean.filterDateType == 'DAY' or manageReportManagedBean.filterDateType == 'WEEK' or manageReportManagedBean.filterDateType == 'CUSTOM'}">
                                                                                <p:outputLabel for="grp-date-start" value="#{(manageReportManagedBean.filterDateType == 'WEEK' or manageReportManagedBean.filterDateType == 'CUSTOM')? 'Start ' : 'Select '}Date" />
                                                                                <p:inputText id="grp-date-start" value="#{manageReportManagedBean.filterStartDate}" placeholder="dd/mm/yyyy"
                                                                                             required="true" requiredMessage="Start Date Must be Provided">  
                                                                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                                                    <p:ajax event="valueChange" process="@this" update="panelGroupDateSelect" listener="#{manageReportManagedBean.typeFilterDate}"/>
                                                                                </p:inputText>
                                                                                <p:message for="grp-date-start" class="error-message"/>
                                                                            </ui:fragment>
                                                                            <ui:fragment rendered="#{manageReportManagedBean.filterDateType == 'MONTH'}">
                                                                                <p:outputLabel for="grp-date-month" value="Select Month" />
                                                                                <p:inputText id="grp-date-month" value="#{manageReportManagedBean.filterStartDate}" placeholder="mmm yyyy"
                                                                                             required="true" requiredMessage="Month and Year Must be Provided">  
                                                                                    <f:convertDateTime pattern="MMM yyyy"/>
                                                                                    <p:ajax event="valueChange" process="@this" update="panelGroupDateSelect"/>
                                                                                </p:inputText>
                                                                                <p:message for="grp-date-month" class="error-message"/>
                                                                            </ui:fragment>
                                                                            <ui:fragment rendered="#{manageReportManagedBean.filterDateType == 'YEAR'}">
                                                                                <p:outputLabel for="grp-date-year" value="Select Year" />
                                                                                <p:selectOneMenu id="grp-date-year" value="#{manageReportManagedBean.filterStartDate}">  
                                                                                    <f:convertDateTime pattern="yyyy"/>
                                                                                    <f:selectItems value="#{manageReportManagedBean.years}" var="year"/>
                                                                                    <p:ajax event="valueChange" process="@this" update="panelGroupDateSelect"/>
                                                                                </p:selectOneMenu>
                                                                                <p:message for="grp-date-year" class="error-message"/>
                                                                            </ui:fragment>
                                                                        </div>
                                                                        <div class="p-field p-col">
                                                                            <ui:fragment rendered="#{(manageReportManagedBean.filterDateType == 'WEEK' or manageReportManagedBean.filterDateType == 'CUSTOM')}">
                                                                                <p:outputLabel for="grp-date-end" value="End Date" />
                                                                                <p:inputText id="grp-date-end" value="#{manageReportManagedBean.filterEndDate}" placeholder="dd/mm/yyyy"
                                                                                             required="true" requiredMessage="End Date Must be Provided">  
                                                                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                                                    <p:ajax event="valueChange" process="@this" update="panelGroupDateSelect" listener="#{manageReportManagedBean.typeFilterDate}"/>
                                                                                </p:inputText>
                                                                                <p:message for="grp-date-end" class="error-message"/>
                                                                            </ui:fragment>
                                                                        </div>
                                                                    </div>
                                                                    <div class="ui-fluid p-field">
                                                                        <p:datePicker value="#{manageReportManagedBean.filterStartDate}" inline="true" pattern="dd/MM/yyyy" maxdate="#{manageReportManagedBean.today}"
                                                                                      locale="en_GB"
                                                                                      rendered="#{manageReportManagedBean.filterDateType == 'DAY'}">
                                                                            <p:ajax event="dateSelect" process="@this" update="panelGroupDateSelect" resetValues="true"/>
                                                                        </p:datePicker>
                                                                        <p:datePicker view="month" value="#{manageReportManagedBean.filterStartDate}"  inline="true" pattern="MMM yyyy" maxdate="#{manageReportManagedBean.today}"
                                                                                      yearNavigator="true" yearRange="#{manageReportManagedBean.yearRange}" 
                                                                                      locale="en_GB"
                                                                                      rendered="#{manageReportManagedBean.filterDateType == 'MONTH'}">
                                                                            <p:ajax event="dateSelect" process="@this" update="panelGroupDateSelect" />
                                                                        </p:datePicker>
                                                                        <p:datePicker value="#{manageReportManagedBean.filterRangeDates}" inline="true" pattern="dd/MM/yyyy" maxdate="#{manageReportManagedBean.today}"
                                                                                      locale="en_GB" selectionMode="range"
                                                                                      rendered="#{manageReportManagedBean.filterDateType == 'WEEK' or manageReportManagedBean.filterDateType == 'CUSTOM'}">
                                                                            <p:ajax event="dateSelect" process="@this" update="panelGroupDateSelect" listener="#{manageReportManagedBean.selectFilterRangeDate}" resetValues="true"/>
                                                                        </p:datePicker>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </p:outputPanel>
                                                    </ui:fragment>
                                                </div>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{not manageReportManagedBean.checkAddChartDate()}">
                                                <div class="p-field p-col-12">
                                                    <h:outputText value="No date selection required for #{manageReportManagedBean.reportFieldToAddWrapper.reportField.reportDataType.text} : #{manageReportManagedBean.reportFieldToAddWrapper.reportField.reportDataGrouping.text}" style="font-size: 20px"/>
                                                </div>
                                            </h:panelGroup>
                                        </div>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{manageReportManagedBean.idxAddChart == 2}" id="panelGroupChart">
                                        <div class="p-formgrid p-grid ui-fluid">
                                            <div class="p-field p-col-12">
                                                <p:outputLabel for="chart-name" value="Enter Chart Name" />
                                                <p:inputText id="chart-name" value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.name}" placeholder="Chart Name">
                                                    <p:ajax event="valueChange" process="@this" update="@this"/>
                                                </p:inputText>
                                                <p:message for="chart-name" class="error-message"/>
                                            </div>
                                            <div class="p-field p-col-12">
                                                <p:outputLabel for="chart-description" value="Enter Chart Description" />
                                                <p:inputTextarea id="chart-description" value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.description}" placeholder="Chart Description">
                                                    <p:ajax process="@this" update="@this"/>
                                                </p:inputTextarea>
                                            </div>
                                            <div class="p-field p-col-12">
                                                <p:outputLabel for="chart-type" value="Select Chart Type" />
                                                <p:selectOneMenu id="chart-type" value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.type}">
                                                    <f:selectItems value="#{manageReportManagedBean.reportFieldTypes}" var="type" itemLabel="#{type.text}"/>
                                                </p:selectOneMenu>
                                            </div>
                                        </div>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{manageReportManagedBean.idxAddChart == 3}" id="panelGroupPreview">
                                        <div class="p-formgrid p-grid ui-fluid">
                                            <div class="p-col-12 p-col-nogutter">
                                                <div style="display: flex; justify-content: space-between">
                                                    <h:outputText class="field-name" value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.name}"/>
                                                    <h:panelGroup rendered="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.filterDateType ne null and manageReportManagedBean.reportFieldToAddWrapper.reportField.filterDateType != 'NONE'}">
                                                        <div>
                                                            <i class="pi pi-clock field-subtitle p-mr-2"/>
                                                            <h:outputText class="field-subtitle" value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.filterDateString}"/>
                                                        </div>
                                                    </h:panelGroup>
                                                </div>
                                            </div>
                                            <div class="p-col-12 p-col-nogutter">
                                                <p:separator class="p-my-1"/>
                                            </div>
                                            <h:panelGroup rendered="#{not empty manageReportManagedBean.reportFieldToAddWrapper.reportField.description}">
                                                <div class="p-field p-col-12 p-col-nogutter">
                                                    <h:outputText class="field-subtitle" value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.description}"/>
                                                </div>
                                            </h:panelGroup>
                                            <div class="p-col-12">
                                                <p:pieChart model="#{manageReportManagedBean.reportFieldToAddWrapper.chart}" rendered="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.type == 'PIE'}"/>
                                                <ui:fragment rendered="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.type == 'BAR'}">
                                                    <div class="p-grid p-mt-3 p-align-center">
                                                        <div class="p-col-12">
                                                            <div class="p-grid p-align-center">
                                                                <div class="p-col-fixed" style="width:20px">
                                                                    <h:outputText value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.reportDataGrouping.y_axis}" style="padding: 0; writing-mode:vertical-lr;transform: rotate(180deg);"/>
                                                                </div>
                                                                <p:barChart model="#{manageReportManagedBean.reportFieldToAddWrapper.chart}" class="p-col"/>
                                                            </div>
                                                        </div>
                                                        <div class="p-col-fixed" style="width:20px"/>
                                                        <h:outputText value="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.reportDataGrouping.x_axis}" class="p-col" style="text-align: center"/>

                                                    </div>
                                                </ui:fragment>
                                                <p:lineChart model="#{manageReportManagedBean.reportFieldToAddWrapper.chart}" rendered="#{manageReportManagedBean.reportFieldToAddWrapper.reportField.type == 'LINE'}"/>
                                            </div>
                                            <div class="p-col-12 p-mt-2">
                                                <h:outputText class="total-quantity-font" value="Total Quantity: #{manageReportManagedBean.getTotalNumberOfData(manageReportManagedBean.reportFieldToAddWrapper.reportField)}"/>
                                            </div>
                                            <div class="p-col-12 p-mt-5">
                                                <p:commandButton value="#{manageReportManagedBean.getAddChartbtnText()}" icon="pi pi-plus"
                                                                 process="@this" update="panelReport" 
                                                                 actionListener="#{manageReportManagedBean.doConfirmAddChart()}"
                                                                 disabled="#{manageReportManagedBean.getTotalNumberOfData(manageReportManagedBean.reportFieldToAddWrapper.reportField) == 0}"
                                                                 oncomplete="PF('dialogAddChart').hide()"/>
                                            </div>
                                        </div>
                                    </h:panelGroup>
                                </div>
                                <p:commandButton update="panelAddChart"  process="panelAddChart"
                                                 disabled="#{manageReportManagedBean.idxAddChart == 3}"
                                                 icon="pi pi-angle-right" styleClass="rounded-button outlined-button p-ml-2"  style="width: 2.5rem; height: 2.5rem"
                                                 actionListener="#{manageReportManagedBean.doDialogAddChartNextPage()}"
                                                 oncomplete="PF('dialogAddChart').initPosition()">
                                </p:commandButton>
                            </div>
                        </div>
                    </div>
                </p:outputPanel>
            </p:dialog>
        </h:form>
    </ui:define>

</ui:composition>

